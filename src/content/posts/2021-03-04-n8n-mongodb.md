---
template: blog-post
title: "N8N& MongoDB  "
slug: n8nmongo
date: 2021-03-04 11:53
description: Some tips for how to use MongoDB with N8N.
---
One big question with setting up N8N workflows is "where to store the data?" that's generated by regular jobs. 

MongoDB is by far and away the best way to store data that is generated by N8N workflows. It's what's I would term "JSON native" as there's no need to manipulate the data that's returned by a node before inserting it into a MongoDB collection. For something like the five-day forecast from the OpenWeather node, this is a massive deal.   

With MongoDB Atlas, it is super quick and cheap to set up a MongoDB instance in the cloud with your choice of providers.   

It's also easy to alter what is stored in the MongoDB collection over time - either because the node that you're using changes what is being sent back, or if you want to either add or delete additional data. Either way, compared to a database with a set schema that either needs to be updated, or more likely will fail with changes to the input, MongoDB is much less fragile.  

It's easy to manipulate the data going into the MongoDB collection by using a Set node. For instance, adding an ID field based on DateTime (see below). You can also use dot notation within the Set node to add in additional fields at different levels of the JSON so that you can maintain the structure.  

Learnings from using MongoDB for a few workflows:  
  - Each collection that you have requires a separate Connection in N8N. If you're new to N8N, make sure that you've set an environment variable with a set encryption key so that you can access existing keys.   
  - Don't use the objectID field that is automatically generated by Mongo as a key for updating or deleting documents. It doesn't play nicely with N8N. Instead, I created a new ID field based on DateTime in milliseconds which does a pretty good job of ensuring uniqueness.   
  - Queries take a while to get your head around, but here are some tips. Generally, `""` are your friend and should be put around anything that's a string.  
    - MongoDB query structures are pretty well documented on MongoDB's site.   
    - `{"id":"name"}` will return any id that matches "name". This is all you need in the query field.   
    - `{"id":"name", "id2":"name2"}` will return any id that matches both criteria (i.e. it's an AND)  
    - `{"id": {"$gte": 1111}}` will find any ID greater than or equal to 1111. Note that there are various operators like Greater than or equal to (GTE) that need to have $ before them and be included in `""`.   
    - You can add in the results from nodes in other parts of your workflow using the "Add xxx" feature. Beyond referencing the correct part of the result, there's no need to modify the result beyond that. Remember to put `""` around the reference if it's a string.  
